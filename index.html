<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìºìŠ¤íŒ… ìŠ¤ì¼€ì¤„ ìë™ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(39, 39, 42, 0.5);
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(20, 184, 166, 0.3);
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(20, 184, 166, 0.5);
    }

    .table-cell-highlight {
      position: relative;
      overflow: hidden;
    }

    .table-cell-highlight::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(20, 184, 166, 0.1) 0%, rgba(20, 184, 166, 0.3) 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .table-cell-highlight.active::before {
      opacity: 1;
    }

    table * {
      writing-mode: horizontal-tb !important;
      text-orientation: mixed !important;
    }
  </style>
</head>

<body class="min-h-screen bg-zinc-950 text-white">

  <div class="fixed inset-0 opacity-5 pointer-events-none">
    <div class="absolute inset-0"
      style="background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.02) 10px, rgba(255,255,255,0.02) 20px)">
    </div>
  </div>

  <div class="relative">
    <header class="border-b border-teal-700/30 bg-zinc-950/50 backdrop-blur-sm">
      <div class="max-w-7xl mx-auto px-6 py-8">
        <div class="text-center">
          <h1
          class="text-5xl md:text-6xl font-black mb-4 tracking-tight cursor-pointer transition-colors"
          onclick="showHomeSection()"
          >
            ìºìŠ¤íŒ… ìŠ¤ì¼€ì¤„ ìë™ ê´€ë¦¬
          </h1>
          <p class="text-zinc-400 text-lg font-medium">AI Casting Schedule Manager</p>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-12">
      
      <!-- í™ˆ í™”ë©´ -->
      <div id="homeSection">
        <div class="mb-8 flex items-center justify-between">
          <h2 class="text-3xl font-bold text-white">ğŸ“‹ ë‚´ ê³µì—° ë¦¬ìŠ¤íŠ¸</h2>
        </div>

        <!-- ê³µì—° ë¦¬ìŠ¤íŠ¸ -->
        <div id="showsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6"></div>

        <!-- ë¹ˆ ìƒíƒœ -->
        <div id="emptyState" class="text-center py-20">
          <div class="mb-12">
            <div class="w-32 h-32 mx-auto mb-8 bg-zinc-800/50 rounded-3xl flex items-center justify-center border border-zinc-700/50">
              <svg class="w-16 h-16 text-zinc-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-white mb-3">ë“±ë¡ëœ ê³µì—°ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p class="text-zinc-500 text-base">ì²« ë²ˆì§¸ ìºìŠ¤íŒ… ìŠ¤ì¼€ì¤„ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
          </div>
          <button onclick="showUploadSection()" class="inline-flex items-center gap-3 px-8 py-4 bg-teal-500 hover:bg-teal-600 text-white font-bold rounded-xl transition-all shadow-lg shadow-teal-500/20 hover:shadow-teal-500/40 hover:scale-105">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            ì›í•˜ëŠ” ê³µì—°ì´ ì—†ë‚˜ìš”? ì§ì ‘ ì¶”ê°€í•˜ê¸°
          </button>
        </div>

        <!-- í•˜ë‹¨ ë²„íŠ¼ (ê³µì—°ì´ ìˆì„ ë•Œë§Œ í‘œì‹œ) -->
        <div id="addShowButton" class="hidden flex justify-center mt-16 mb-24">
          <button onclick="showUploadSection()" class="inline-flex items-center gap-3 px-8 py-4 bg-teal-500 hover:bg-teal-600 text-white font-bold rounded-xl transition-all shadow-lg shadow-teal-500/20 hover:shadow-teal-500/40 hover:scale-105">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            ì›í•˜ëŠ” ê³µì—°ì´ ì—†ë‚˜ìš”? ì§ì ‘ ì¶”ê°€í•˜ê¸°
          </button>
        </div>
      </div>

      <!-- ì—…ë¡œë“œ í™”ë©´ -->
      <div id="uploadSection" class="hidden">
        <div class="max-w-3xl mx-auto">
          <div class="mb-6 flex justify-between items-center">
            <button onclick="showHomeSection()"
              class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg transition-all inline-flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              ëŒì•„ê°€ê¸°
            </button>
          </div>

          <div id="dropZone"
            class="relative border-2 border-dashed border-teal-500 bg-teal-500/10 rounded-2xl p-16 text-center hover:border-teal-400 hover:bg-teal-500/20 transition-all">
            <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="handleFileSelect(event)" />
            <div class="space-y-4">
              <div class="flex justify-center">
                <svg class="w-20 h-20 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
              <div>
                <h3 class="text-2xl font-semibold text-teal-400 mb-2">ìºìŠ¤íŒ… ìŠ¤ì¼€ì¤„ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h3>
                <p class="text-zinc-400">í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
              </div>
              <div class="flex justify-center gap-4">
                <label for="fileInput"
                  class="px-8 py-4 bg-teal-600 hover:bg-teal-500 text-white font-semibold rounded-xl cursor-pointer transition-all shadow-lg shadow-teal-600/30 hover:shadow-teal-500/50 hover:scale-105 inline-flex items-center gap-3">
                  <span class="inline-flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    ì´ë¯¸ì§€ ì„ íƒ
                  </span>
                </label>
                <button
                  onclick="loadSampleData(event)"
                  class="px-8 py-4 bg-zinc-700 hover:bg-zinc-600 text-white font-semibold rounded-xl cursor-pointer transition-all shadow-lg shadow-zinc-700/20 hover:shadow-zinc-600/40 hover:scale-105 inline-flex items-center gap-3">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                  </svg>
                  ì˜ˆì‹œ ë°ì´í„° ë¡œë“œ
                </button>
              </div>
              <p class="text-xs text-zinc-500 mt-4">ì§€ì› í˜•ì‹: JPG, PNG, GIF, WEBP</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ë¡œë”© í™”ë©´ -->
      <div id="loadingSection" class="hidden">
        <div class="max-w-3xl mx-auto">
          <div class="relative border-2 border-dashed border-teal-500 bg-teal-500/10 rounded-2xl p-16 text-center">
            <div class="space-y-6">
              <div class="flex justify-center">
                <svg class="w-20 h-20 text-teal-500 animate-pulse" fill="none" stroke="currentColor"
                  viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                </svg>
              </div>
              <div>
                <h3 class="text-2xl font-semibold text-teal-400 mb-2">AIê°€ ìºìŠ¤íŒ… ìŠ¤ì¼€ì¤„ ë¶„ì„ ì¤‘...</h3>
                <p class="text-zinc-400">ë°°ìš°ì™€ ì¶œì—° ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ì—ìš”. 1ë¶„ì •ë„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”! </p>
              </div>
              <div class="flex justify-center gap-2">
                <div class="w-3 h-3 bg-teal-500 rounded-full animate-bounce"></div>
                <div class="w-3 h-3 bg-teal-500 rounded-full animate-bounce" style="animation-delay: 0.1s;"></div>
                <div class="w-3 h-3 bg-teal-500 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- í™•ì¸ ë° ìˆ˜ì • í™”ë©´ -->
      <div id="confirmSection" class="hidden">
        <div class="mb-6 flex items-center justify-between">
          <button onclick="showUploadSection()"
            class="flex items-center gap-2 px-4 py-2 bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 rounded-md text-zinc-300 font-medium transition-all">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            ë‹¤ì‹œ ì—…ë¡œë“œí•˜ê¸°
          </button>
          
          <h2 class="text-3xl font-black text-white">ğŸ“ ë°ì´í„° í™•ì¸ ë° ìˆ˜ì •</h2>
          
          <div class="flex gap-3">
            <button id="deleteFromConfirmBtn"
              class="flex items-center gap-2 px-4 py-2 bg-red-900/50 hover:bg-red-900/70 border border-red-700 rounded-md text-red-300 font-medium transition-all">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              ì‚­ì œ
            </button>
            
            <button onclick="proceedToSave()"
              class="flex items-center gap-2 px-6 py-3 bg-teal-500 hover:bg-teal-600 text-white font-bold rounded-lg transition-all shadow-lg shadow-teal-500/20">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              ì €ì¥í•˜ê¸°
            </button>
          </div>
        </div>

        <div class="bg-zinc-900/50 border border-teal-700/30 rounded-lg p-6 mb-6">
          <p class="text-zinc-400 mb-4">AIê°€ ë¶„ì„í•œ ë‚´ìš©ì„ í™•ì¸í•˜ê³ , ì˜ëª»ëœ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ìˆ˜ì •í•´ì£¼ì„¸ìš”.</p>
          
          <!-- ê³µì—°ëª… ì…ë ¥ -->
          <div class="mb-6">
            <label class="block text-sm font-bold text-teal-400 mb-3">ê³µì—°ëª…</label>
            <input type="text" id="showNameEditInput" 
              class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-teal-500 transition-colors"
              placeholder="ì˜ˆ: 2026 ë°ìŠ¤ë…¸íŠ¸"
            />
          </div>

          <!-- ë°°ìš° ì´ë¦„ ì¼ê´„ ë³€ê²½ -->
          <div class="mb-6 p-4 bg-zinc-800/50 border border-zinc-700 rounded-lg">
            <div class="flex items-center gap-2 mb-3">
              <svg class="w-5 h-5 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
              </svg>
              <label class="text-sm font-bold text-teal-400">ë°°ìš° ì´ë¦„ ì¼ê´„ ë³€ê²½</label>
            </div>
            <p class="text-xs text-zinc-500 mb-3">ì˜ëª» ì¸ì‹ëœ ë°°ìš° ì´ë¦„ì„ ëª¨ë“  ì¼ì •ì—ì„œ í•œ ë²ˆì— ë³€ê²½í•©ë‹ˆë‹¤.</p>
            <div class="flex gap-3">
              <input type="text" id="findActorInput" 
                placeholder="ì°¾ì„ ì´ë¦„ (ì˜ˆ: ê¹€ë¯¼ìˆ˜)"
                class="flex-1 px-3 py-2 bg-zinc-900 border border-zinc-700 rounded-lg text-white text-sm placeholder-zinc-500 focus:outline-none focus:border-teal-500 transition-colors"
              />
              <span class="flex items-center text-zinc-500">â†’</span>
              <input type="text" id="replaceActorInput" 
                placeholder="ë°”ê¿€ ì´ë¦„ (ì˜ˆ: ê¹€ë¯¼ìˆ˜)"
                class="flex-1 px-3 py-2 bg-zinc-900 border border-zinc-700 rounded-lg text-white text-sm placeholder-zinc-500 focus:outline-none focus:border-teal-500 transition-colors"
              />
              <button onclick="replaceActorName()"
                class="px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white text-sm font-semibold rounded-lg transition-all">
                ë³€ê²½
              </button>
            </div>
          </div>
          
          <!-- ì—­í•  ìˆ˜ì • -->
          <div class="mb-6">
            <label class="block text-sm font-bold text-teal-400 mb-3">ì—­í•  (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input type="text" id="rolesInput" 
              class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-teal-500 transition-colors"
              placeholder="ì˜ˆ: ì—˜ì‚¬, ì•ˆë‚˜, í¬ë¦¬ìŠ¤í† í”„"
            />
          </div>

          <!-- ì¼ì • í…Œì´ë¸” ìˆ˜ì • -->
          <div>
            <div class="flex items-center justify-between mb-3">
              <label class="block text-sm font-bold text-teal-400">ê³µì—° ì¼ì •</label>
              <button onclick="addScheduleRow()"
                class="flex items-center gap-1 px-3 py-1 bg-teal-600 hover:bg-teal-700 text-white text-sm font-semibold rounded-md transition-all">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                í–‰ ì¶”ê°€
              </button>
            </div>
            <div class="overflow-x-auto rounded-lg border border-zinc-700">
              <table class="w-full">
                <thead class="bg-zinc-800/80">
                  <tr>
                    <th class="px-3 py-2 text-left text-xs font-bold text-zinc-400 border-r border-zinc-700">ë‚ ì§œ</th>
                    <th class="px-3 py-2 text-center text-xs font-bold text-zinc-400 border-r border-zinc-700">ìš”ì¼</th>
                    <th class="px-3 py-2 text-center text-xs font-bold text-zinc-400 border-r border-zinc-700">ì‹œê°„</th>
                    <th class="px-3 py-2 text-left text-xs font-bold text-zinc-400 border-r border-zinc-700">ë°°ìš° (ì‰¼í‘œ êµ¬ë¶„)</th>
                    <th class="px-3 py-2 text-center text-xs font-bold text-zinc-400">ì‚­ì œ</th>
                  </tr>
                </thead>
                <tbody id="scheduleEditTable"></tbody>
              </table>
            </div>
          </div>

          <!-- íŠ¹ì´ì‚¬í•­ -->
          <div class="mt-6">
            <label class="block text-sm font-bold text-teal-400 mb-3">íŠ¹ì´ì‚¬í•­</label>
            <textarea id="noteInput" rows="3" 
              class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-lg text-white placeholder-zinc-500 focus:outline-none focus:border-teal-500 transition-colors"
              placeholder="ê³µì—° ê´€ë ¨ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>
        </div>
      </div>

      <!-- ë°ì´í„° í‘œì‹œ í™”ë©´ -->
      <div id="dataSection" class="hidden">
        <div class="mb-8 flex items-center justify-between">
          <div class="flex items-center gap-4">
            <button onclick="showHomeSection()"
              class="px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg transition-all inline-flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              ëŒì•„ê°€ê¸°
            </button>
            <h2 id="currentShowTitle" class="text-3xl font-black text-white"></h2>
          </div>
          <div class="flex gap-2">
            <button id="editShowBtn"
              class="px-4 py-2 bg-teal-600 hover:bg-teal-500 text-white rounded-lg transition-all inline-flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
              ìˆ˜ì •
            </button>
            <button id="deleteShowBtn"
              class="px-4 py-2 bg-red-900/50 hover:bg-red-900/70 border border-red-700 rounded-lg text-red-300 font-medium transition-all inline-flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              ì‚­ì œ
            </button>
          </div>
        </div>

        <div class="mb-6 space-y-4 bg-zinc-900/50 border border-zinc-800 rounded-lg p-6">
          <div class="flex items-center gap-4 flex-wrap">
            <div class="flex items-center gap-2 text-teal-400">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
              </svg>
              <span class="font-bold">ë°°ìš° í•„í„°:</span>
            </div>

            <div class="relative flex-1 min-w-[200px] max-w-xs">
              <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <input type="text" id="searchInput" placeholder="ë°°ìš° ê²€ìƒ‰..."
                class="w-full pl-10 pr-4 py-2 bg-zinc-800 border border-zinc-700 rounded-md text-white placeholder-zinc-500 focus:outline-none focus:border-teal-500 transition-colors" />
            </div>

            <div id="selectedActorBadge"
              class="hidden flex items-center gap-2 px-4 py-2 bg-teal-500/20 border border-teal-500 rounded-md">
              <svg class="w-4 h-4 text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span id="selectedActorsText" class="font-semibold text-teal-300"></span>
              <button id="clearFilterBtn" class="ml-2 hover:bg-teal-500/30 rounded-full p-1 transition-colors">
                <svg class="w-4 h-4 text-teal-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            <span id="filterHint" class="text-zinc-500 text-sm">ë°°ìš°ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ì¶œì—° íšŒì°¨ë§Œ í‘œì‹œë©ë‹ˆë‹¤ (ì—¬ëŸ¬ ëª… ì„ íƒ ì‹œ ëª¨ë‘ ì¶œì—°í•œ íšŒì°¨ë§Œ í‘œì‹œ)</span>
          </div>

          <div id="actorButtons" class="mt-4 flex flex-wrap gap-2"></div>
        </div>

        <div id="showInfo" class="hidden mb-6 p-4 bg-teal-500/10 border border-teal-500/30 rounded-lg">
          <div class="flex items-center gap-2 text-teal-400">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span id="showInfoText" class="font-semibold"></span>
          </div>
        </div>

        <div class="overflow-x-auto rounded-lg border-2 border-teal-700/50 shadow-2xl">
          <table id="castingTable" class="w-full">
            <thead id="tableHead"></thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>

        <!-- ìƒˆ ìŠ¤ì¼€ì¤„ ì¶”ê°€ ë²„íŠ¼ -->
        <div class="mt-16 mb-24 text-center">
          <button onclick="addMoreSchedule()"
            class="px-8 py-4 bg-gradient-to-r from-teal-600 to-teal-500 hover:from-teal-500 hover:to-teal-400 text-white font-bold rounded-xl shadow-lg shadow-teal-600/30 hover:shadow-teal-500/50 transition-all hover:scale-105 inline-flex items-center gap-4">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="size-6"> 
              <path stroke-linecap="round" stroke-linejoin="round" 
              d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" /> 
            </svg>

        <!-- í…ìŠ¤íŠ¸ (ë‘ ì¤„+ì¤‘ì•™ì •ë ¬)-->
         <div class="flex flex-col items-center text-center gap-1">
            <span class="font-bold text-base leading-snug">
              ìƒˆë¡œìš´ ìŠ¤ì¼€ì¤„ì´ ì˜¬ë¼ì™”ë‚˜ìš”?
            </span>
            <span class="text-sm font-normal opacity-90">
              ì´ë¯¸ì§€ ì—…ë¡œë“œí•˜ê¸°
            </span>
          </div>
          
          </button>
        </div>

        <div class="mt-6 text-center">
          <p id="scheduleNote" class="text-zinc-500 text-sm"></p>
        </div>

        <div id="statsSection" class="hidden mt-8 grid grid-cols-1 md:grid-cols-3 gap-6"></div>
      </div>
    </main>
  </div>

  <!-- ì €ì¥ ëª¨ë‹¬ -->
  <div id="saveModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-zinc-900 border-2 border-teal-700/50 rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
      <h3 class="text-2xl font-black text-white mb-4">ê³µì—°ëª… ì…ë ¥</h3>
      <input type="text" id="showNameInput" placeholder="ì˜ˆ: 2026 ë°ìŠ¤ë…¸íŠ¸"
        class="w-full px-4 py-3 bg-zinc-800 border border-zinc-700 rounded-lg text-white focus:outline-none focus:border-teal-500 mb-6" />
      <div class="flex gap-3">
        <button onclick="cancelSave()"
          class="flex-1 px-4 py-3 bg-zinc-800 hover:bg-zinc-700 text-white font-semibold rounded-lg transition-all">
          ì·¨ì†Œ
        </button>
        <button onclick="confirmSave()"
          class="flex-1 px-4 py-3 bg-teal-600 hover:bg-teal-500 text-white font-semibold rounded-lg transition-all">
          ì €ì¥
        </button>
      </div>
    </div>
  </div>

  <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
  <div id="deleteModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-zinc-900 border-2 border-red-700/50 rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
      <div class="flex items-center gap-3 mb-4">
        <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <h3 class="text-2xl font-black text-white">ê³µì—° ì‚­ì œ</h3>
      </div>
      <p class="text-zinc-300 mb-6">
        <span id="deleteShowName" class="font-bold text-white"></span> ê³µì—°ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br />
        <span class="text-sm text-zinc-500">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>
      </p>
      <div class="flex gap-3">
        <button onclick="cancelDelete()"
          class="flex-1 px-4 py-3 bg-zinc-800 hover:bg-zinc-700 text-white font-semibold rounded-lg transition-all">
          ì·¨ì†Œ
        </button>
        <button onclick="confirmDelete()"
          class="flex-1 px-4 py-3 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg transition-all">
          ì‚­ì œ
        </button>
      </div>
    </div>
  </div>

  <script>
    // ===== ê¸°ì¡´ ì½”ë“œ ë³€ìˆ˜ë“¤ =====
    let castingData = null;
    let selectedActors = [];
    let allActors = [];
    let actorStats = {};

    // ===== ìƒˆë¡œ ì¶”ê°€ëœ ë³€ìˆ˜ë“¤ =====
    let shows = {};
    let currentShowId = null;
    let tempCastingData = null;
    let pendingDeleteShowId = null;

    // ===== DOM ìš”ì†Œ ì°¸ì¡° =====
    const homeSection = document.getElementById('homeSection');
    const uploadSection = document.getElementById('uploadSection');
    const loadingSection = document.getElementById('loadingSection');
    const confirmSection = document.getElementById('confirmSection');
    const dataSection = document.getElementById('dataSection');
    const saveModal = document.getElementById('saveModal');
    const deleteModal = document.getElementById('deleteModal');
    const showsList = document.getElementById('showsList');
    const emptyState = document.getElementById('emptyState');
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const searchInput = document.getElementById('searchInput');
    const actorButtons = document.getElementById('actorButtons');
    const selectedActorBadge = document.getElementById('selectedActorBadge');
    const selectedActorsText = document.getElementById('selectedActorsText');
    const clearFilterBtn = document.getElementById('clearFilterBtn');
    const filterHint = document.getElementById('filterHint');
    const showInfo = document.getElementById('showInfo');
    const showInfoText = document.getElementById('showInfoText');
    const tableHead = document.getElementById('tableHead');
    const tableBody = document.getElementById('tableBody');
    const scheduleNote = document.getElementById('scheduleNote');
    const statsSection = document.getElementById('statsSection');
    const currentShowTitle = document.getElementById('currentShowTitle');
    const editShowBtn = document.getElementById('editShowBtn');
    const deleteShowBtn = document.getElementById('deleteShowBtn');
    const showNameInput = document.getElementById('showNameInput');
    const showNameEditInput = document.getElementById('showNameEditInput');
    const deleteShowName = document.getElementById('deleteShowName');
    const rolesInput = document.getElementById('rolesInput');
    const scheduleEditTable = document.getElementById('scheduleEditTable');
    const noteInput = document.getElementById('noteInput');

    // ===== ì´ˆê¸°í™” =====
    loadShows();
    renderHome();

    // ===== LocalStorage ê´€ë¦¬ =====
    function loadShows() {
      const saved = localStorage.getItem('castingShows');
      if (saved) {
        shows = JSON.parse(saved);
      }
    }

    function saveShows() {
      localStorage.setItem('castingShows', JSON.stringify(shows));
    }

    // ===== í™ˆ í™”ë©´ ë Œë”ë§ =====
    function renderHome() {
      const showsArray = Object.entries(shows);
      const addShowButton = document.getElementById('addShowButton');

      if (showsArray.length === 0) {
        emptyState.classList.remove('hidden');
        showsList.classList.add('hidden');
        addShowButton.classList.add('hidden');
      } else {
        emptyState.classList.add('hidden');
        showsList.classList.remove('hidden');
        addShowButton.classList.remove('hidden');

        showsList.innerHTML = showsArray.map(([showId, show]) => `
          <div class="bg-zinc-900/50 border-2 border-zinc-800 hover:border-teal-700/50 rounded-xl p-6 cursor-pointer transition-all hover:shadow-lg hover:shadow-teal-700/20"
            onclick="viewShow('${showId}')">
            <div class="flex justify-between items-start mb-4">
              <h3 class="text-xl font-black text-white">${show.name}</h3>
              <button 
                class="delete-show-btn p-2 hover:bg-red-900/30 rounded-lg transition-colors"
                data-show-id="${showId}">
                <svg class="w-5 h-5 text-zinc-600 hover:text-red-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
              </button>
            </div>
            <div class="space-y-2 text-sm text-zinc-400">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>ì´ ${show.data.schedule.length}íšŒ ê³µì—°</span>
              </div>
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <span>${show.data.roles.join(', ')}</span>
              </div>
            </div>
          </div>
        `).join('');

        setTimeout(() => {
          document.querySelectorAll('.delete-show-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
              e.stopPropagation();
              e.preventDefault();
              const showId = btn.dataset.showId;
              console.log('Deleting show ID:', showId);
              deleteShowFromHome(showId);
            });
          });
        }, 100);
      }
    }

    // ===== í™”ë©´ ì „í™˜ í•¨ìˆ˜ë“¤ =====
    function showHomeSection() {
      homeSection.classList.remove('hidden');
      uploadSection.classList.add('hidden');
      loadingSection.classList.add('hidden');
      confirmSection.classList.add('hidden');
      dataSection.classList.add('hidden');
      currentShowId = null;
      castingData = null;
      selectedActors = [];
      renderHome();
    }

    function showUploadSection() {
      homeSection.classList.add('hidden');
      uploadSection.classList.remove('hidden');
      loadingSection.classList.add('hidden');
      confirmSection.classList.add('hidden');
      dataSection.classList.add('hidden');
      fileInput.value = '';
    }

    function showConfirmSection() {
      homeSection.classList.add('hidden');
      uploadSection.classList.add('hidden');
      loadingSection.classList.add('hidden');
      confirmSection.classList.remove('hidden');
      dataSection.classList.add('hidden');

      if (currentShowId && shows[currentShowId]) {
        showNameEditInput.value = shows[currentShowId].name;
      } else {
        showNameEditInput.value = '';
      }
      rolesInput.value = tempCastingData.roles.join(', ');
      noteInput.value = tempCastingData.note || '';
      renderScheduleEditTable();
    }

    function viewShow(showId) {
      currentShowId = showId;
      castingData = shows[showId].data;
      currentShowTitle.textContent = shows[showId].name;
      
      selectedActors = []; //ë°°ìš°ì„ íƒ ì´ˆê¸°í™”

      processData();
      showData();
      updateFilterUI();
      
      homeSection.classList.add('hidden');
      uploadSection.classList.add('hidden');
      loadingSection.classList.add('hidden');
      confirmSection.classList.add('hidden');
      dataSection.classList.remove('hidden');
    }

    // ===== ê³µì—° ì‚­ì œ =====
    function deleteShowFromHome(showId) {
      console.log('deleteShowFromHome called with:', showId);
      
      const show = shows[showId];
      if (!show) {
        console.error('Show not found!');
        alert('ê³µì—°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      pendingDeleteShowId = showId;
      deleteShowName.textContent = `"${show.name}"`;
      deleteModal.classList.remove('hidden');
    }

    function confirmDelete() {
      if (!pendingDeleteShowId) return;
      
      console.log('Deleting show:', pendingDeleteShowId);
      const wasViewingThisShow = (currentShowId === pendingDeleteShowId);
      
      delete shows[pendingDeleteShowId];
      saveShows();
      console.log('After delete, remaining shows:', Object.keys(shows).length);
      
      deleteModal.classList.add('hidden');
      pendingDeleteShowId = null;
      
      if (wasViewingThisShow) {
        showHomeSection();
      } else {
        renderHome();
      }
    }

    function cancelDelete() {
      deleteModal.classList.add('hidden');
      pendingDeleteShowId = null;
    }

    document.getElementById('deleteFromConfirmBtn').addEventListener('click', () => {
      if (currentShowId) {
        deleteShowFromHome(currentShowId);
      } else {
        tempCastingData = null;
        showHomeSection();
      }
    });

    editShowBtn.addEventListener('click', () => {
      if (currentShowId) {
        tempCastingData = JSON.parse(JSON.stringify(shows[currentShowId].data));
        showConfirmSection();
      }
    });

    deleteShowBtn.addEventListener('click', () => {
      if (currentShowId) {
        deleteShowFromHome(currentShowId);
      }
    });

    // ===== ì¶”ê°€ ìŠ¤ì¼€ì¤„ ì—…ë¡œë“œ ê¸°ëŠ¥ =====
    function addMoreSchedule() {
      if (!currentShowId) {
        alert('ê³µì—°ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const additionalFileInput = document.createElement('input');
      additionalFileInput.type = 'file';
      additionalFileInput.accept = 'image/*';
      additionalFileInput.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.type.startsWith('image/')) {
          alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          return;
        }

        dataSection.classList.add('hidden');
        loadingSection.classList.remove('hidden');

        const reader = new FileReader();
        reader.onload = async (e) => {
          const base64Data = e.target.result.split(',')[1];
          await processAdditionalImage(base64Data);
        };
        reader.readAsDataURL(file);
      };
      additionalFileInput.click();
    }

    // ğŸ†• ì¶”ê°€ ì´ë¯¸ì§€ ì²˜ë¦¬ (ë™ê·¸ë¼ë¯¸ ì²˜ë¦¬ í¬í•¨)
    async function processAdditionalImage(imageData) {
      try {
        const response = await fetch("/api/analyze", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            imageData: imageData
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          console.error("API Error Response:", errorData);
          throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
        }

        const data = await response.json();
        console.log("API Response:", data);

        if (!data.content || !Array.isArray(data.content)) {
          throw new Error("ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        if (data.stop_reason === "max_tokens") {
          throw new Error("ì‘ë‹µì´ ë„ˆë¬´ ê¸¸ì–´ ì¤‘ê°„ì— ì˜ë ¸ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ë¶„í• í•˜ì—¬ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
        }

        const text = data.content.map(item => item.text || "").join("\n").trim();
        const cleanText = text.replace(/```json|```/g, "").trim();
        const newCastingData = JSON.parse(cleanText);

        // ğŸ†• ë™ê·¸ë¼ë¯¸ ì²˜ë¦¬
        processFirstLastShow(newCastingData);

        if (newCastingData.schedule && newCastingData.schedule.length > 0) {
          shows[currentShowId].data.schedule = [
            ...shows[currentShowId].data.schedule,
            ...newCastingData.schedule
          ];
          
          saveShows();
          
          loadingSection.classList.add('hidden');
          alert(`${newCastingData.schedule.length}ê°œì˜ ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
          
          viewShow(currentShowId);
        } else {
          throw new Error("ìƒˆë¡œìš´ ì¼ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      } catch (error) {
        console.error("Processing error:", error);
        alert(`ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì—ëŸ¬: ${error.message}\n\nê°œë°œì ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
        loadingSection.classList.add('hidden');
        viewShow(currentShowId);
      }
    }

    // ===== ë“œë˜ê·¸ ì•¤ ë“œë¡­ =====
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('border-teal-400', 'bg-teal-500/20');
    });

    dropZone.addEventListener('dragleave', (e) => {
      e.preventDefault();
      dropZone.classList.remove('border-teal-400', 'bg-teal-500/20');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('border-teal-400', 'bg-teal-500/20');

      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        handleFile(file);
      } else {
        alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      }
    });

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        handleFile(file);
      }
    }

    function handleFile(file) {
      if (!file.type.startsWith('image/')) {
        alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
      }

      uploadSection.classList.add('hidden');
      loadingSection.classList.remove('hidden');

      const reader = new FileReader();
      reader.onload = async (e) => {
        const base64Data = e.target.result.split(',')[1];
        await processImage(base64Data);
      };
      reader.readAsDataURL(file);
    }

    // ğŸ†• ì´ë¯¸ì§€ ì²˜ë¦¬ (ë™ê·¸ë¼ë¯¸ ê°ì§€ ë° ì²«ê³µ/ë§‰ê³µ ì²˜ë¦¬ ì¶”ê°€)
    async function processImage(imageData) {
      try {
        const response = await fetch("/api/analyze", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            imageData: imageData
          })
        });

        if (!response.ok) {
          const errorData = await response.json();
          console.error("API Error Response:", errorData);
          throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
        }

        const data = await response.json();
        console.log("API Response:", data);

        if (!data.content || !Array.isArray(data.content)) {
          throw new Error("ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        if (data.stop_reason === "max_tokens") {
          throw new Error("ì‘ë‹µì´ ë„ˆë¬´ ê¸¸ì–´ ì¤‘ê°„ì— ì˜ë ¸ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ë¥¼ ë¶„í• í•˜ì—¬ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
        }

        const text = data.content.map(item => item.text || "").join("\n").trim();
        const cleanText = text.replace(/```json|```/g, "").trim();
        tempCastingData = JSON.parse(cleanText);

        // ğŸ†• ì—­í• ì—ì„œ ë‚ ì§œ, ìš”ì¼, ì‹œê°„ ì œê±°
        const excludedRoles = ['ë‚ ì§œ', 'ìš”ì¼', 'ì‹œê°„'];
        tempCastingData.roles = tempCastingData.roles.filter(role => 
          role && !excludedRoles.some(excluded => role === excluded)
        );

        // ğŸ†• ë™ê·¸ë¼ë¯¸(â—, â—‹, â€¢) ê°ì§€ ë° ì²«ê³µ/ë§‰ê³µ ì²˜ë¦¬
        processFirstLastShow(tempCastingData);

        loadingSection.classList.add('hidden');
        showConfirmSection();
      } catch (error) {
        console.error("Processing error:", error);
        alert(`ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì—ëŸ¬: ${error.message}\n\nê°œë°œì ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
        loadingSection.classList.add('hidden');
        uploadSection.classList.remove('hidden');
      }
    }

   // ğŸ†• ì²«ê³µ/ë§‰ê³µ ì²˜ë¦¬ í•¨ìˆ˜
function processFirstLastShow(data) {
  if (!data.schedule || data.schedule.length === 0) return;

  // í•œê¸€ ì´ë¦„ ê²€ì¦ í•¨ìˆ˜
  function isValidKoreanName(name) {
    const koreanRegex = /^[ê°€-í£]+$/;
    return koreanRegex.test(name);
  }

  // ë‚ ì§œë³„ë¡œ ì •ë ¬
  const sortedSchedule = [...data.schedule].sort((a, b) => {
    const dateA = parseDateString(a.date);
    const dateB = parseDateString(b.date);
    return dateA - dateB;
  });

  const firstShowDate = sortedSchedule[0].date;
  const lastShowDate = sortedSchedule[sortedSchedule.length - 1].date;

  // ê° ìŠ¤ì¼€ì¤„ì˜ ë°°ìš° ì´ë¦„ì—ì„œ ë™ê·¸ë¼ë¯¸ í™•ì¸ ë° ì œê±°
  data.schedule.forEach(show => {
    show.cast = show.cast
      .map(actorName => {
        // ë™ê·¸ë¼ë¯¸ì™€ íŠ¹ìˆ˜ ê¸°í˜¸ ì œê±°
        const cleanName = actorName.replace(/[â—â—‹â€¢â—‰â—â‘©ãŠ—]+/g, '').trim();
        
        return cleanName;
      })
      .filter(cleanName => {
        // í•œê¸€ ì´ë¦„ë§Œ ë‚¨ê¸°ê¸°
        return isValidKoreanName(cleanName) && cleanName.length > 1;
      })
      .map(cleanName => {
        // ì²«ê³µ/ë§‰ê³µ íƒœê·¸ ì¶”ê°€
        if (show.date === firstShowDate) {
          return `${cleanName} (ì²«ê³µ)`;
        } else if (show.date === lastShowDate) {
          return `${cleanName} (ë§‰ê³µ)`;
        }
        
        return cleanName;
      });
  });

  // ë¹ˆ ìºìŠ¤íŠ¸ ì œê±°
  data.schedule = data.schedule.filter(show => show.cast.length > 0);
}

    // ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
    function parseDateString(dateStr) {
      // "03.15 (ê¸ˆ)" í˜•ì‹ì„ íŒŒì‹±
      const match = dateStr.match(/(\d+)\.(\d+)/);
      if (match) {
        const month = parseInt(match[1]);
        const day = parseInt(match[2]);
        const currentYear = new Date().getFullYear();
        return new Date(currentYear, month - 1, day);
      }
      return new Date();
    }

    // ===== ë°°ìš° ì´ë¦„ ì¼ê´„ ë³€ê²½ =====
    function replaceActorName() {
      const findName = document.getElementById('findActorInput').value.trim();
      const replaceName = document.getElementById('replaceActorInput').value.trim();
      
      if (!findName) {
        alert('ì°¾ì„ ë°°ìš° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      
      if (!replaceName) {
        alert('ë°”ê¿€ ë°°ìš° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }
      
      let replacedCount = 0;
      
      tempCastingData.schedule.forEach(show => {
        show.cast = show.cast.map(actor => {
          if (actor.trim() === findName) {
            replacedCount++;
            return replaceName;
          }
          return actor;
        });
      });
      
      if (replacedCount > 0) {
        alert(`"${findName}"ì„(ë¥¼) "${replaceName}"(ìœ¼)ë¡œ ${replacedCount}ê°œ í•­ëª© ë³€ê²½í–ˆìŠµë‹ˆë‹¤.`);
        renderScheduleEditTable();
        
        document.getElementById('findActorInput').value = '';
        document.getElementById('replaceActorInput').value = '';
      } else {
        alert(`"${findName}" ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
      }
    }

    // ===== ì¼ì • ìˆ˜ì • í…Œì´ë¸” ë Œë”ë§ =====
    function renderScheduleEditTable() {
      scheduleEditTable.innerHTML = tempCastingData.schedule.map((show, index) => `
        <tr class="bg-zinc-900/30">
          <td class="px-3 py-2 border-r border-zinc-700 w-28">
            <input type="text" value="${show.date}" 
              data-index="${index}" data-field="date"
              class="schedule-field w-full px-2 py-1 bg-zinc-800 border border-zinc-700 rounded text-white text-sm focus:outline-none focus:border-teal-500" />
          </td>
          <td class="px-3 py-2 border-r border-zinc-700 w-16">
            <input type="text" value="${show.day}" 
              data-index="${index}" data-field="day"
              class="schedule-field w-full px-2 py-1 bg-zinc-800 border border-zinc-700 rounded text-white text-sm text-center focus:outline-none focus:border-teal-500" />
          </td>
          <td class="px-3 py-2 border-r border-zinc-700 w-20">
            <input type="text" value="${show.time}" 
              data-index="${index}" data-field="time"
              class="schedule-field w-full px-2 py-1 bg-zinc-800 border border-zinc-700 rounded text-white text-sm text-center focus:outline-none focus:border-teal-500" />
          </td>
          <td class="px-3 py-2 border-r border-zinc-700">
            <input type="text" value="${show.cast.join(', ')}" 
              data-index="${index}" data-field="cast"
              class="schedule-field w-full px-2 py-1 bg-zinc-800 border border-zinc-700 rounded text-white text-sm focus:outline-none focus:border-teal-500" />
          </td>
          <td class="px-3 py-2 text-center w-16">
            <button data-index="${index}" class="delete-schedule-btn p-1 hover:bg-red-900/30 rounded transition-colors">
              <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </td>
        </tr>
      `).join('');

      document.querySelectorAll('.schedule-field').forEach(input => {
        input.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.index);
          const field = e.target.dataset.field;
          updateScheduleField(index, field, e.target.value);
        });
      });

      document.querySelectorAll('.delete-schedule-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(btn.dataset.index);
          deleteScheduleRow(index);
        });
      });
    }

    function updateScheduleField(index, field, value) {
      if (field === 'cast') {
        tempCastingData.schedule[index][field] = value.split(',').map(s => s.trim()).filter(Boolean);
      } else {
        tempCastingData.schedule[index][field] = value;
      }
    }

    function addScheduleRow() {
      tempCastingData.schedule.push({
        date: "",
        day: "",
        time: "",
        cast: []
      });
      renderScheduleEditTable();
    }

    function deleteScheduleRow(index) {
      tempCastingData.schedule.splice(index, 1);
      renderScheduleEditTable();
    }

    // ===== ì €ì¥ ì§„í–‰ =====
    function proceedToSave() {
      const showName = showNameEditInput.value.trim();
      if (!showName) {
        alert('ê³µì—°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const rolesText = rolesInput.value.trim();
      if (!rolesText) {
        alert('ì—­í• ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      // ìë™ ì œì™¸ ëª©ë¡ ì¶”ê°€
      const excludedRoles = ['ë‚ ì§œ', 'ìš”ì¼', 'ì‹œê°„'];

      tempCastingData.roles = rolesText.split(',').map(s => s.trim()).filter(role => 
      role &&!excludedRoles.some(excluded => role === excluded));

      if (tempCastingData.schedule.length === 0) {
        alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì¼ì •ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      tempCastingData.note = noteInput.value.trim();

      if (currentShowId) {
        shows[currentShowId] = {
          name: showName,
          data: tempCastingData
        };
        
        saveShows();
        tempCastingData = null;
        
        alert(`"${showName}" ê³µì—°ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        viewShow(currentShowId);
      } else {
        const showId = Date.now().toString();
        shows[showId] = {
          name: showName,
          data: tempCastingData
        };
        
        saveShows();
        tempCastingData = null;
        
        alert(`"${showName}" ê³µì—°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        showHomeSection();
      }
    }

    // ğŸ†• processData - ë™ê·¸ë¼ë¯¸ì™€ ì²«ê³µ/ë§‰ê³µ íƒœê·¸ ì œê±° í›„ ì¤‘ë³µ ì œê±°
    function processData() {
      const actorsSet = new Set();
      
      const excludeKeywords = [
        'ê³µì—°ì—†ìŒ',
        'ê³µì—° ì—†ìŒ',
        'ì—†ìŒ',
        'x',
        '-',
        'íœ´ë¬´',
        'ê³µì—°x',
        'ê³µì—° x'
      ];
      
      castingData.schedule.forEach(show => {
        show.cast.forEach(actor => {
          let cleanActor = actor.trim();
          
          if (!cleanActor) return;
          
          // ğŸ†• ë™ê·¸ë¼ë¯¸(â—, â—‹, â€¢) ì œê±°
          cleanActor = cleanActor.replace(/[â—â—‹â€¢â—‰â—â‘©]/g, '').trim();
          
          // ğŸ†• (ì²«ê³µ), (ë§‰ê³µ) íƒœê·¸ ì œê±°
          cleanActor = cleanActor.replace(/\s*\(ì²«ê³µ\)/g, '').replace(/\s*\(ë§‰ê³µ\)/g, '').trim();
          
          if (cleanActor.length === 1) {
            console.log(`í•œ ê¸€ì ë°°ìš° ì´ë¦„ ì œì™¸: "${cleanActor}"`);
            return;
          }
          
          const normalizedActor = cleanActor.toLowerCase().replace(/\s+/g, '');
          const shouldExclude = excludeKeywords.some(keyword => {
            const normalizedKeyword = keyword.toLowerCase().replace(/\s+/g, '');
            return normalizedActor === normalizedKeyword;
          });
          
          if (!shouldExclude) {
            actorsSet.add(cleanActor);
          }
        });
      });
      
      allActors = Array.from(actorsSet).sort();

      actorStats = {};
      allActors.forEach(actor => {
        actorStats[actor] = castingData.schedule.filter(show =>
          show.cast.some(castActor => {
            // ğŸ†• ë™ê·¸ë¼ë¯¸ì™€ íƒœê·¸ ì œê±° í›„ ë¹„êµ
            const cleanCastActor = castActor
              .replace(/[â—â—‹â€¢â—‰â—â‘©]/g, '')
              .replace(/\s*\(ì²«ê³µ\)/g, '')
              .replace(/\s*\(ë§‰ê³µ\)/g, '')
              .trim();
            return cleanCastActor === actor;
          })
        ).length;
      });
    }

    function showData() {
  renderActorButtons();
  renderTable();

  if (castingData.note) {
    scheduleNote.textContent = castingData.note;
  }
}

function renderActorButtons(searchQuery = '') {
  // í˜„ì¬ ê³µì—°ì˜ ì‹¤ì œ ë°°ìš° ëª©ë¡ë§Œ ì¶”ì¶œ
  const currentShowActors = new Set();
  castingData.schedule.forEach(show => {
    show.cast.forEach(actor => {
      let cleanActor = actor
        .replace(/[â—â—‹â€¢â—‰â—â‘©]/g, '') // ë™ê·¸ë¼ë¯¸ ì œê±°
        .replace(/\s*\(ì²«ê³µ\)/g, '') // ì²«ê³µ íƒœê·¸ ì œê±°
        .replace(/\s*\(ë§‰ê³µ\)/g, '') // ë§‰ê³µ íƒœê·¸ ì œê±°
        .trim();
      
      // í•œê¸€ ì´ë¦„ ê²€ì¦ ì¶”ê°€
      const koreanRegex = /^[ê°€-í£]+$/;

      // ì¶”ê°€: ê³µì—°ì—†ìŒ, ì—†ìŒ ë“±ì˜ í‚¤ì›Œë“œ ì œì™¸
      const excludeKeywords = [
        'ê³µì—°ì—†ìŒ', 'ê³µì—° ì—†ìŒ', 'ì—†ìŒ', 
        'x', '-', 'íœ´ë¬´', 'ê³µì—°x', 'ê³µì—° x'
       ];


      if (
        cleanActor && 
        cleanActor.length > 1 && 
        koreanRegex.test(cleanActor) &&
        !excludeKeywords.includes(cleanActor)
      ) {
        currentShowActors.add(cleanActor);
      }
    });
  });

  const filteredActors = Array.from(currentShowActors)
    .filter(actor => actor.toLowerCase().includes(searchQuery.toLowerCase()))
    .sort();

  actorButtons.innerHTML = filteredActors.map(actor => `
    <button
      onclick="selectActor('${actor}')"
      class="px-4 py-2 rounded-md font-bold transition-all ${
        selectedActors.includes(actor)
          ? 'bg-teal-500 text-white shadow-lg shadow-teal-500/30'
          : 'bg-zinc-800 text-zinc-300 hover:bg-zinc-700 border border-zinc-700'
      }"
    >
      ${actor}
      <span class="ml-2 text-xs font-semibold opacity-70">(${actorStats[actor] || 0})</span>
    </button>
  `).join('');
}

    function selectActor(actorName) {
      const index = selectedActors.indexOf(actorName);
      if (index > -1) {
        selectedActors.splice(index, 1);
      } else {
        selectedActors.push(actorName);
      }
      
      renderActorButtons(searchInput.value);
      renderTable();
      updateFilterUI();
    }

    // ğŸ†• updateFilterUI - ë™ê·¸ë¼ë¯¸ì™€ íƒœê·¸ ì œê±° í›„ ë¹„êµ
    function updateFilterUI() {
      if (selectedActors.length > 0) {
        selectedActorBadge.classList.remove('hidden');
        filterHint.classList.add('hidden');
        
        selectedActorsText.textContent = selectedActors.join(', ');

        const totalCount = castingData.schedule.filter(show => {
          return selectedActors.every(actor => {
            return show.cast.some(castActor => {
              // ğŸ†• ë™ê·¸ë¼ë¯¸ì™€ íƒœê·¸ ì œê±° í›„ ë¹„êµ
              const cleanCastActor = castActor
                .replace(/[â—â—‹â€¢â—‰â—â‘©]/g, '')
                .replace(/\s*\(ì²«ê³µ\)/g, '')
                .replace(/\s*\(ë§‰ê³µ\)/g, '')
                .trim();
              return cleanCastActor === actor;
            });
          });
        }).length;

        showInfo.classList.remove('hidden');
        showInfoText.textContent = `ì„ íƒí•œ ë°°ìš° ì¶œì—° ì¼ì •: ì´ ${totalCount}íšŒ`;

        renderStats();
      } else {
        selectedActorBadge.classList.add('hidden');
        filterHint.classList.remove('hidden');
        showInfo.classList.add('hidden');
        statsSection.classList.add('hidden');
      }
    }

    // ğŸ†• renderTable - ë™ê·¸ë¼ë¯¸ì™€ íƒœê·¸ ì œê±° í›„ í•„í„°ë§
    function renderTable() {
      const filteredSchedule = selectedActors.length > 0 ?
        castingData.schedule.filter(show => 
          selectedActors.every(actor => {
            return show.cast.some(castActor => {
              // ğŸ†• ë™ê·¸ë¼ë¯¸ì™€ íƒœê·¸ ì œê±° í›„ ë¹„êµ
              const cleanCastActor = castActor
                .replace(/[â—â—‹â€¢â—‰â—â‘©]/g, '')
                .replace(/\s*\(ì²«ê³µ\)/g, '')
                .replace(/\s*\(ë§‰ê³µ\)/g, '')
                .trim();
              return cleanCastActor === actor;
            });
          })
        ) :
        castingData.schedule;

      tableHead.innerHTML = `
        <tr class="bg-teal-800/80 backdrop-blur">
          <th class="px-4 py-4 text-center font-black text-base tracking-tight border-r border-teal-700/50 whitespace-nowrap">ë‚ ì§œ</th>
          <th class="px-4 py-4 text-center font-black text-base tracking-tight border-r border-teal-700/50 whitespace-nowrap">ìš”ì¼</th>
          <th class="px-4 py-4 text-center font-black text-base tracking-tight border-r border-teal-700/50 whitespace-nowrap">ì‹œê°„</th>
          ${castingData.roles.map(role => `
            <th class="px-4 py-4 text-center font-black text-base tracking-tight border-r border-teal-700/50 last:border-r-0 whitespace-nowrap">${role}</th>
          `).join('')}
        </tr>
      `;

      tableBody.innerHTML = filteredSchedule.map(show => `
        <tr class="border-b border-zinc-800 hover:bg-zinc-900/50 transition-colors">
          <td class="px-4 py-4 border-r border-zinc-800 bg-zinc-900/30 whitespace-nowrap text-center">
            <div class="text-base font-black">${show.date}</div>
          </td>
          <td class="px-4 py-4 border-r border-zinc-800 bg-zinc-900/30 whitespace-nowrap text-center">
            <div class="text-base font-semibold text-zinc-300">${show.day}</div>
          </td>
          <td class="px-4 py-4 border-r border-zinc-800 bg-zinc-900/30 whitespace-nowrap text-center">
            <div class="text-base font-semibold text-zinc-300">${show.time}</div>
          </td>
          ${show.cast.map((actor, castIdx) => `
            <td class="px-4 py-4 text-center border-r border-zinc-800 last:border-r-0 transition-all table-cell-highlight whitespace-nowrap ${
              isActorInShow(show, castIdx) ?
                'active bg-teal-500/30 font-black text-teal-300 ring-2 ring-inset ring-teal-500/50' : 'text-zinc-300 font-semibold'
            }">
              <button onclick="selectActor('${actor.replace(/[â—â—‹â€¢â—‰â—â‘©]/g, '').replace(/\s*\(ì²«ê³µ\)/g, '').replace(/\s*\(ë§‰ê³µ\)/g, '').trim()}')" class="hover:text-teal-400 transition-colors w-full">
                ${actor}
              </button>
            </td>
          `).join('')}
        </tr>
      `).join('');
    }

    // ğŸ†• isActorInShow - ë™ê·¸ë¼ë¯¸ì™€ íƒœê·¸ ì œê±° í›„ ë¹„êµ
    function isActorInShow(show, roleIndex) {
      const actorAtRole = show.cast[roleIndex];
      // ğŸ†• ë™ê·¸ë¼ë¯¸ì™€ íƒœê·¸ ì œê±° í›„ ë¹„êµ
      const cleanActorAtRole = actorAtRole
        .replace(/[â—â—‹â€¢â—‰â—â‘©]/g, '')
        .replace(/\s*\(ì²«ê³µ\)/g, '')
        .replace(/\s*\(ë§‰ê³µ\)/g, '')
        .trim();
      return selectedActors.includes(cleanActorAtRole);
    }

    function renderStats() {
      // í†µê³„ ì„¹ì…˜ ì‚¬ìš© ì•ˆ í•¨
      statsSection.classList.add('hidden');
    }

    searchInput.addEventListener('input', (e) => {
      renderActorButtons(e.target.value);
    });

    clearFilterBtn.addEventListener('click', () => {
      selectedActors = [];
      renderActorButtons(searchInput.value);
      renderTable();
      updateFilterUI();
    });

    // ===== ì˜ˆì‹œ ë°ì´í„° ë¡œë“œ =====
    function loadSampleData(event) {
      if (event) {
        event.stopPropagation();
      }
      
      tempCastingData = {
        "roles": ["ì—˜ì‚¬", "ì•ˆë‚˜", "í¬ë¦¬ìŠ¤í† í”„"],
        "schedule": [
          {
            "date": "03.15 (ê¸ˆ)",
            "day": "ê¸ˆ",
            "time": "14:00",
            "cast": ["ê¹€ë¯¼ìˆ˜", "ì´ì§€ì€", "ë°•ì„œì¤€"]
          },
          {
            "date": "03.15 (ê¸ˆ)",
            "day": "ê¸ˆ",
            "time": "19:00",
            "cast": ["ìµœìˆ˜ì§„", "ì´ì§€ì€", "ê³µì—°ì—†ìŒ"]
          },
          {
            "date": "03.16 (í† )",
            "day": "í† ",
            "time": "14:00",
            "cast": ["ê¹€ë¯¼ìˆ˜", "ì •í•˜ì€", "ë°•ì„œì¤€"]
          },
          {
            "date": "03.16 (í† )",
            "day": "í† ",
            "time": "19:00",
            "cast": ["ìµœìˆ˜ì§„", "ì •í•˜ì€", "ê°•ë¯¼í˜¸"]
          }
        ],
        "note": "â€» ì¼ì •ì€ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
      };

      uploadSection.classList.add('hidden');
      showConfirmSection();
    }

    function cancelSave() {
      saveModal.classList.add('hidden');
    }

    function confirmSave() {
      saveModal.classList.add('hidden');
    }
  </script>
</body>

</html>